#+TITLE: WLAN

* WLAN

The *Wi-Fi* industry alliance promotes the *IEEE 802.11* interoperability, the Wireless Ethernet LANs standard for
- Physical layer :: Uses unlicensed bands, 2.4GHz (with 14 channels, 3 non-overlapping) and 5GHz.
- Data link layer :: Quite similar to Ethernet (IEEE 802.3).

The WLAN standard
- Sets for the physical layer the use of unlicensed bands, 2.4GHz (with 14 channels, 3 non-overlapping) and 5GHz, while the Data link layer is quite similar to Ethernet (IEEE 802.3).
- Defines two roles: *Access Point (AP)*, to bridge wireless (802.11) and wired (802.3) connectivity, *Wireless station (STA)*, that is any device with a Network Interface Card (NIC) identified with a MAC address.
- Operates in two modes: *infrastructure mode*, where STAs communicate only with APs, and *ad-hoc mode*, with no AP involved and STAs communicating with each other.
- Defines the wired newtork (Ethernet) as *distribution network*, while the wireless architecture can be
  - Basic Service Set (BSS) :: One AP grants access to the STAs, the AP's MAC usually is used for the Basic Service Set identifier (BSSID).
  - Extended Service Set (ESS) :: Multiple APs, in the same network segment or different ones, use the same Service Set Identifier (SSID).

WLANs can be affected by several threats
- Signal interception allows sniffing leaving no traces.
- Unauthorized network access.
- APs misconfiguration and unauthorized APs.
- DoS by signal jamming, only limit is the proximity.
- AP spoofing, exploiting the fact that STAs connect to AP with stronger signal.
- MitM attack by AP, in particular with open AP.

From the security point of view, WLAN protocols try to deliver
- Data confidentiality and integrity, preventing sniffing and spoofing.
- Access control, grant access only to authorized STAs.
- Accounting, requiring metering abilities.
- Authentication, for access control and accounting.
- Availability, mitigate signal jamming.

** Entering and leaving an open WLAN

An AP advertises its WLAN by sending, every 50ms, beacons with the SSID.
- Joining phase :: An unauthenticated and unassociated STA that wants to join the WLAN must
  - Intercept the beacon and send an authentication request (just an empty message)
  - When confirmed by the AP, send an association request
- Leaving phase :: Both STAs and APs that leave a WLAN must explicitly state it, either with a disassociation or deauthentication notification.

* WPA2

The *Wi-Fi Protected Access 2* (*WPA2*) protocol implements the IEEE 802.11i standard, using
- The 802.1X standard for access control and Extensible Authentication Protocol (EAP) for authentication and key exchange (e.g. EAP-TLS).
- AES-CCMP for confidentiality and integrity.
- Two possible settings: personal, for home networks, and enterprise.

The key hierarchy for a *Robust Security Network* (*RSN*) is shown below.
- A pseudo-random function (e.g. PBKDF2) takes a passphrase to generate the PSK.
- While all STAs share the same PSK, the PTKs are used for traffic encryption between STA and AP.
- In the personal setting the PSK is equal to the PMK.

[[./img/rsn_hierarchy.jpg]]

After a STA is associated with an AP, a *4-way handshake* is executed inside an *EAPOL tunnel*
1. AP sends $counter$ and its nonce $N_{AP}$ (to prevent replay attacks).
2. STA can now compute the $PTK$, and replies with $counter$, its nonce $N_{STA}$ and a message integrity code for the current frame (a MAC) $MIC_{KCK}(frame)$.
3. AP can now compute the $PTK$, and replies to provide a proof of knowledge
4. STA sends also a proof of knowledge

[[./img/wpa2_4whs.jpg]]

In general, the use of passphrases is seens as a weak defense mechanism. The whole key management is affected by several weaknesses related to their use, in particular
- PSK is used for both the authentication phase and the encryption.
- By capturing message 3 and 4 of the 4-way handshake with a deauthentication, one can execute an offline dictionary attack and validate the guess: no forward secrecy is guaranteed once the passphrase is guessed, for any past, present and future exchange.

** Key Reinstallation AttaCK

With *Key Reinstallation AttaCK* (*KRACK*) the attacker creates a rogue AP and sends spoofed management frames, waiting a STA to connect. Since the management frames are unprotected, the rogue AP is able to forge them and deliver a MITM attack.

A mitigation for this kind of attack can be the *Protected Managment Frame* protocol 802.11w, which is covers a set of frames including disassociation, de-authentication, Robust Action frames.

** Enterprise setting

The enterprise mode provides a stronger authentication by using a server, that is not the AP, and combines 802.11 with 802.1X.

The *802.1X* standard was originally designed for port-based access control for switches and modem banks, and is used here to control ports of WLAN APs.

In the 802.11/802.1X, the Authentication Server (AS) authenticates the supplicant through a EAP channel.

[[./img/802.11_802.1X.jpg]]

** EAP, EAPOL and RADIUS

*Extensible Authentication Protocol* (*EAP*) provides encapsulation (without providing itself security) of authentication protocols to define generic authentication messages. EAP precedes 802.1X and uses the term peer instead of supplicant. In EAP the authenticator acts as a passthrough for the end-points, who exchange request and respons messages.

[[./img/eap.jpg]]

One of the protocols supported by EAP is TLS, that is used for the exchange between peer and EAP server.

[[./img/eaptls.jpg]]

EAP encapsulation uses EAPOL (EAP over LAN) on the 802.11 link, and Remote access dial-in user service (RADIUS) over the wired network.

[[./img/eapenc.jpg]]

RADIUS is used to encapsulate EAP and uses its own protocol for shared keys for the end-points, defining messages between
- Network Access Server (NAS) :: That in WLAN is the AP
- Authentication Server :: Who responds to access requests with a challenge, and a accept or reject message.

The overall context is shown below
1. Joining phase
   - An unauthenticated and unassociated STA intercepts the beacon sent by the AP with its SSID
   - Dealing open-authentication, the authentication request/response always succeds
   - Association is made with AP and a port opens for 802.1X communication to communicate with RADIUS server
2. EAPOL between STA, AP (and later RADIUS server)
3. RADIUS between STA and RADIUS server
4. 4-way handshake starts to generate the PTK

[[./img/eapcontext.jpg]]

The STA, AP and RADIUS server also need to holds certificates previously signed from a certificate authority.

* WPA3

WPA3 introduces a new mode, *Opportunistic Wireless Encryption* (*OWE*), that doesn't involve any password and uses DH for key exchange between APs and STAs.

[[./img/wpa3_4whs.jpg]]

A non-authenticated DH is used, so MITM attack can be delivered. Still it is an improvement on WPA2, since the attacker needs to be active (no offline dictionary attack) and there is forward secrecy.

WPA3 uses *Dragonfly*, a Password Authenticated Key Exchange (PAKE), to combining OWE with the use of a passphrase and implement a ADH key exchange. This mode prevents offline dictionary attacks to take place.
